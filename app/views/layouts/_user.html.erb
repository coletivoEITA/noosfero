<div id="user">
  <% user = (session[:user] && User.find_by_id(session[:user])) || nil %>
  <% if user.present? %>
    <% user = user.person %>
    <span class='logged-in'>
      <%= usermenu_logged_in %>
    </span>
  <% else %>
    <span class='not-logged-in'>
      <span class='login'>
        <%= modal_inline_link_to(content_tag(:i, nil, class: 'icon-menu-login') + content_tag(:strong, _('Login')), login_url, '#inlineLoginBox', id: 'link_login') %>
      </span>
      <%= @plugins.dispatch(:alternative_authentication_link).map{ |content| instance_exec &content }.safe_join %>

    <div id='inlineLoginBox' style='display: none;'>
      <%= render :file => 'account/login', :locals => { :is_popin => true } %>
    </div>

    <% unless @plugins.dispatch(:allow_user_registration).include?(false) %>
      <span class='or'><= _'or' %></span>
      <span class='signup'>
        <%= link_to(content_tag(:strong, _('Sign up')), controller: 'account', action: 'signup') %>
      </span>
    <% end %>

  </span>
  <% end %>
  <form action="/search/articles" id="top-search" class="search_form clean" method="get">
    <input name="query" size="15" title="<%=_('Search...')%>" onfocus="this.form.className='focused';" onblur="this.form.className=''" />
    <div><%=_('Press <strong>Enter</strong> to send the search query.')%></div>
    <%= javascript_tag 'jQuery("#user form input").hint();' %>
  </form>
</div><!-- end id="user" -->
